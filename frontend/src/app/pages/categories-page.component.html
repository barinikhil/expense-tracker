<mat-card class="panel">
  <mat-card-header>
    <mat-card-title>Categories</mat-card-title>
    <mat-card-subtitle>Manage your expense groups.</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <div *ngIf="error" class="error">
      <mat-icon>error</mat-icon>
      <span>{{ error }}</span>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Name</mat-label>
        <input matInput [(ngModel)]="newCategory.name" placeholder="Category name" />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Description</mat-label>
        <input matInput [(ngModel)]="newCategory.description" placeholder="Description" />
      </mat-form-field>
      <button mat-flat-button class="primary-button" (click)="addCategory()">Add Category</button>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Sub-categories</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let category of categories">
            <ng-container *ngIf="editingCategoryId !== category.id; else editCategoryRow">
              <td>{{ category.name }}</td>
              <td>{{ category.description }}</td>
              <td>{{ subCategoryNames(category) || '-' }}</td>
              <td class="actions-cell">
                <button mat-stroked-button class="ghost-button" (click)="startEditCategory(category)">
                  <mat-icon>edit</mat-icon>
                  <span>Edit</span>
                </button>
              </td>
            </ng-container>
            <ng-template #editCategoryRow>
              <td>
                <mat-form-field appearance="outline" class="inline-field">
                  <input matInput [(ngModel)]="editingCategory.name" />
                </mat-form-field>
              </td>
              <td>
                <mat-form-field appearance="outline" class="inline-field">
                  <input matInput [(ngModel)]="editingCategory.description" />
                </mat-form-field>
              </td>
              <td>-</td>
              <td class="actions-cell">
                <button mat-flat-button class="primary-button" (click)="saveCategoryEdit()">Save</button>
                <button mat-stroked-button class="ghost-button" (click)="cancelCategoryEdit()">Cancel</button>
              </td>
            </ng-template>
          </tr>
          <tr *ngIf="!categories.length">
            <td colspan="4" class="empty-cell">No categories found.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </mat-card-content>
</mat-card>
