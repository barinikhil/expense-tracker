<mat-card class="taxonomy-panel">
  <mat-card-header>
    <mat-card-title>{{ pageTitle }}</mat-card-title>
    <mat-card-subtitle>{{ pageSubtitle }}</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <div *ngIf="error" class="taxonomy-error">
      <mat-icon>error</mat-icon>
      <span>{{ error }}</span>
    </div>

    <div class="expense-top-actions">
      <a mat-flat-button class="primary-button" [routerLink]="addRoute">
        Add {{ transactionType === 'INCOME' ? 'Income' : 'Expense' }}
      </a>
    </div>

    <div class="expense-filter-bar">
      <div class="expense-date-field">
        <label for="startDate">From</label>
        <input id="startDate" type="date" [(ngModel)]="startDate">
      </div>
      <div class="expense-date-field">
        <label for="endDate">To</label>
        <input id="endDate" type="date" [(ngModel)]="endDate">
      </div>
      <div class="expense-date-field">
        <label for="category">Category</label>
        <select id="category" [(ngModel)]="categoryId" (ngModelChange)="onCategoryChange()">
          <option [ngValue]="null">All</option>
          <option *ngFor="let category of filteredCategories" [ngValue]="category.id">{{ category.name }}</option>
        </select>
      </div>
      <div class="expense-date-field">
        <label for="subCategory">Sub-category</label>
        <select id="subCategory" [(ngModel)]="subCategoryId" [disabled]="!categoryId">
          <option [ngValue]="null">All</option>
          <option *ngFor="let subCategory of filteredSubCategories" [ngValue]="subCategory.id">{{ subCategory.name }}</option>
        </select>
      </div>
      <div class="expense-date-field">
        <label for="minAmount">Min Amount</label>
        <input id="minAmount" type="number" min="0" step="0.01" [(ngModel)]="minAmount">
      </div>
      <div class="expense-date-field">
        <label for="maxAmount">Max Amount</label>
        <input id="maxAmount" type="number" min="0" step="0.01" [(ngModel)]="maxAmount">
      </div>
      <div class="expense-filter-actions">
        <button mat-flat-button class="primary-button" type="button" (click)="applyFilters()">Apply</button>
        <button mat-button type="button" (click)="resetToCurrentMonth()">Current Month</button>
      </div>
    </div>

    <div class="taxonomy-table-wrap">
      <table class="taxonomy-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Description</th>
            <th>
              <button type="button" class="expense-sort-btn" (click)="toggleSort('amount')">
                Amount <span>{{ sortIndicator('amount') }}</span>
              </button>
            </th>
            <th>
              <button type="button" class="expense-sort-btn" (click)="toggleSort('category')">
                Category <span>{{ sortIndicator('category') }}</span>
              </button>
            </th>
            <th>
              <button type="button" class="expense-sort-btn" (click)="toggleSort('subCategory')">
                Sub-category <span>{{ sortIndicator('subCategory') }}</span>
              </button>
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let expense of expenses">
            <td>{{ expense.expenseDate }}</td>
            <td>{{ expense.description }}</td>
            <td>{{ expense.amount | number:'1.2-2' }}</td>
            <td>{{ expense.categoryName }}</td>
            <td>{{ expense.subCategoryName }}</td>
            <td class="expense-row-actions">
              <a
                mat-icon-button
                class="expense-action-icon"
                [routerLink]="editRoute(expense.id)"
                aria-label="Edit transaction"
                title="Edit"
              >
                <mat-icon>edit</mat-icon>
              </a>
              <button
                mat-icon-button
                color="warn"
                type="button"
                class="expense-action-icon"
                [disabled]="deletingTransactionId !== null"
                (click)="deleteTransaction(expense)"
                aria-label="Delete transaction"
                title="Delete"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </tr>
          <tr *ngIf="!expenses.length">
            <td colspan="6" class="taxonomy-empty-cell">
              No {{ transactionType === 'INCOME' ? 'income' : 'expense' }} records found.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="expense-pagination" *ngIf="totalElements">
      <span class="expense-pagination-info">
        Showing {{ pageStartRecord }}-{{ pageEndRecord }} of {{ totalElements }}
      </span>
      <div class="expense-pagination-actions">
        <label class="expense-page-size-label" for="expensePageSize">Rows</label>
        <select
          id="expensePageSize"
          class="expense-page-size-select"
          [(ngModel)]="pageSize"
          (ngModelChange)="onPageSizeChange()"
        >
          <option *ngFor="let option of pageSizeOptions" [ngValue]="option">{{ option }}</option>
        </select>
        <button mat-button type="button" (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
        <span class="expense-pagination-page">Page {{ currentPage }} / {{ totalPages }}</span>
        <button mat-button type="button" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
      </div>
    </div>
  </mat-card-content>
</mat-card>
