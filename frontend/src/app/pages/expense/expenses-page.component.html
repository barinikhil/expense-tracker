<mat-card class="taxonomy-panel">
  <mat-card-header>
    <mat-card-title>Expenses</mat-card-title>
    <mat-card-subtitle>Add and track your spending entries.</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <div *ngIf="error" class="taxonomy-error">
      <mat-icon>error</mat-icon>
      <span>{{ error }}</span>
    </div>

    <form #expenseForm="ngForm" class="taxonomy-form-row" (ngSubmit)="addExpense()">
      <mat-form-field appearance="outline">
        <mat-label>Amount</mat-label>
        <input
          matInput
          type="number"
          min="0.01"
          step="0.01"
          name="amount"
          required
          #amountModel="ngModel"
          [(ngModel)]="newExpense.amount"
          placeholder="0.00"
        />
        <mat-error *ngIf="(expenseForm.submitted || amountModel.touched) && amountModel.invalid">
          Amount is required.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Description</mat-label>
        <input
          matInput
          name="description"
          required
          #descriptionModel="ngModel"
          [(ngModel)]="newExpense.description"
          placeholder="Expense description"
        />
        <mat-error *ngIf="(expenseForm.submitted || descriptionModel.touched) && descriptionModel.invalid">
          Description is required.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Date</mat-label>
        <input
          matInput
          type="date"
          name="expenseDate"
          required
          #dateModel="ngModel"
          [(ngModel)]="newExpense.expenseDate"
        />
        <mat-error *ngIf="(expenseForm.submitted || dateModel.touched) && dateModel.invalid">
          Date is required.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Category</mat-label>
        <mat-select
          name="category"
          required
          #categoryModel="ngModel"
          [(ngModel)]="newExpense.categoryId"
          (selectionChange)="onCategoryChange()"
        >
          <mat-option [value]="null">Select category</mat-option>
          <mat-option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</mat-option>
        </mat-select>
        <mat-error *ngIf="(expenseForm.submitted || categoryModel.touched) && categoryModel.invalid">
          Category is required.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Sub-category</mat-label>
        <mat-select
          name="subCategory"
          required
          #subCategoryModel="ngModel"
          [(ngModel)]="newExpense.subCategoryId"
          [disabled]="!newExpense.categoryId"
        >
          <mat-option [value]="null">Select sub-category</mat-option>
          <mat-option *ngFor="let subCategory of availableSubCategories" [value]="subCategory.id">
            {{ subCategory.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="(expenseForm.submitted || subCategoryModel.touched) && subCategoryModel.invalid">
          Sub-category is required.
        </mat-error>
      </mat-form-field>

      <button mat-flat-button type="submit" class="primary-button">Add Expense</button>
    </form>

    <div class="taxonomy-table-wrap">
      <table class="taxonomy-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Category</th>
            <th>Sub-category</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let expense of expenses">
            <td>{{ expense.expenseDate }}</td>
            <td>{{ expense.description }}</td>
            <td>{{ expense.amount | number:'1.2-2' }}</td>
            <td>{{ expense.categoryName }}</td>
            <td>{{ expense.subCategoryName }}</td>
          </tr>
          <tr *ngIf="!expenses.length">
            <td colspan="5" class="taxonomy-empty-cell">No expenses found.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </mat-card-content>
</mat-card>
