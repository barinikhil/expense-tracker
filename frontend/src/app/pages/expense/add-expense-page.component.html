<mat-card class="taxonomy-panel">
  <mat-card-header>
    <mat-card-title>{{ pageTitle }}</mat-card-title>
    <mat-card-subtitle>{{ pageSubtitle }}</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <div *ngIf="error" class="taxonomy-error">
      <mat-icon>error</mat-icon>
      <span>{{ error }}</span>
    </div>

    <form #expenseForm="ngForm" class="expense-form-horizontal" (ngSubmit)="saveTransaction()">
      <mat-form-field appearance="outline">
        <mat-label>Amount</mat-label>
        <input
          matInput
          type="number"
          min="0.01"
          step="0.01"
          name="amount"
          required
          #amountModel="ngModel"
          [(ngModel)]="newExpense.amount"
          placeholder="0.00"
        />
        <mat-error *ngIf="(expenseForm.submitted || amountModel.touched) && amountModel.invalid">
          Amount is required.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Description</mat-label>
        <input
          matInput
          name="description"
          required
          #descriptionModel="ngModel"
          [(ngModel)]="newExpense.description"
          [placeholder]="transactionType === 'INCOME' ? 'Income description' : 'Expense description'"
        />
        <mat-error *ngIf="(expenseForm.submitted || descriptionModel.touched) && descriptionModel.invalid">
          Description is required.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Date</mat-label>
        <input
          matInput
          type="date"
          name="expenseDate"
          required
          #dateModel="ngModel"
          [(ngModel)]="newExpense.expenseDate"
        />
        <mat-error *ngIf="(expenseForm.submitted || dateModel.touched) && dateModel.invalid">
          Date is required.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Category</mat-label>
        <mat-select
          name="category"
          required
          #categoryModel="ngModel"
          [(ngModel)]="newExpense.categoryId"
          (selectionChange)="onCategoryChange()"
        >
          <mat-option [value]="null">Select category</mat-option>
          <mat-option *ngFor="let category of filteredCategories" [value]="category.id">{{ category.name }}</mat-option>
        </mat-select>
        <mat-error *ngIf="(expenseForm.submitted || categoryModel.touched) && categoryModel.invalid">
          Category is required.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Sub-category</mat-label>
        <mat-select
          name="subCategory"
          required
          #subCategoryModel="ngModel"
          [(ngModel)]="newExpense.subCategoryId"
          [disabled]="!newExpense.categoryId"
        >
          <mat-option [value]="null">Select sub-category</mat-option>
          <mat-option *ngFor="let subCategory of availableSubCategories" [value]="subCategory.id">
            {{ subCategory.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="(expenseForm.submitted || subCategoryModel.touched) && subCategoryModel.invalid">
          Sub-category is required.
        </mat-error>
      </mat-form-field>

      <mat-checkbox *ngIf="!isEditMode" [(ngModel)]="returnHereForAnother" name="returnHereForAnother" class="expense-repeat-check">
        After storing, return here to create another one.
      </mat-checkbox>

      <div class="expense-form-actions">
        <button mat-flat-button type="submit" class="primary-button">
          {{ submitLabel }}
        </button>
        <button mat-stroked-button type="button" class="ghost-button" (click)="cancel()">
          Back to {{ transactionType === 'INCOME' ? 'Income' : 'Expense' }} List
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
