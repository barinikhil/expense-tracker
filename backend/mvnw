#!/bin/sh
set -euf

BASEDIR=$(CDPATH= cd -- "$(dirname -- "$0")" && pwd)
WRAPPER_DIR="$BASEDIR/.mvn/wrapper"
WRAPPER_JAR="$WRAPPER_DIR/maven-wrapper.jar"
WRAPPER_PROPS="$WRAPPER_DIR/maven-wrapper.properties"

if [ ! -f "$WRAPPER_JAR" ]; then
  if [ ! -f "$WRAPPER_PROPS" ]; then
    echo "Missing $WRAPPER_PROPS" >&2
    exit 1
  fi

  wrapper_url=$(sed -n 's/^wrapperUrl=//p' "$WRAPPER_PROPS")
  if [ -z "$wrapper_url" ]; then
    echo "wrapperUrl not found in $WRAPPER_PROPS" >&2
    exit 1
  fi

  mkdir -p "$WRAPPER_DIR"
  if command -v curl >/dev/null 2>&1; then
    curl -fsSL "$wrapper_url" -o "$WRAPPER_JAR"
  elif command -v wget >/dev/null 2>&1; then
    wget -q "$wrapper_url" -O "$WRAPPER_JAR"
  else
    echo "Neither curl nor wget is available to download $wrapper_url" >&2
    exit 1
  fi
fi

exec java -classpath "$WRAPPER_JAR" org.apache.maven.wrapper.MavenWrapperMain "$@"
